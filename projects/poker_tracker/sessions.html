---
title: PokerTracker - Sessions
nav_id: sessions
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>{{ page.title | default: "PokerTracker" }}</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  {% include_relative components/nav-bar.html %}

  <main>
    <div class="container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Sessions</h1>
    <div style="display: flex; gap: 1rem;">
      <button class="btn" onclick="goToActiveSession()" id="liveSessionBtn">Live</button>
      <button class="btn btn-primary" onclick="PokerTracker.Modal.showNewSessionModal()">+ New Session</button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <input type="text" class="filter-input" placeholder="Search sessions..." id="sessionSearch">
    <select class="filter-input" id="gameFilter">
      <option value="">All Games</option>
      <option value="aria-1-3">Aria 1/3</option>
      <option value="home-game">Home Game</option>
      <option value="bellagio-2-5">Bellagio 2/5</option>
      <option value="wynn-5-10">Wynn 5/10</option>
      <option value="commerce-3-5">Commerce 3/5</option>
    </select>
    <div class="date-filter-group">
      <label class="filter-label">From Date</label>
      <input type="date" class="filter-input" id="dateFrom">
    </div>
    <div class="date-filter-group">
      <label class="filter-label">To Date</label>
      <input type="date" class="filter-input" id="dateTo">
    </div>
    <select class="filter-input" id="profitFilter">
      <option value="">All Results</option>
      <option value="positive">Winning Sessions</option>
      <option value="negative">Losing Sessions</option>
    </select>
  </div>

  <!-- Sessions Table (Desktop) -->
  <div class="card desktop-view">
    <div class="card-content">
      <div class="table-container">
        <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Game</th>
            <th>Duration</th>
            <th>Buy-in</th>
            <th>Cash-out</th>
            <th>P&L</th>
            <th>Hands</th>
            <th>VPIP</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="sessionsTableBody">
          <!-- Populated by JavaScript -->
        </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Sessions Cards (Mobile) -->
  <div class="mobile-view">
    <div id="sessionsCardContainer">
      <!-- Populated by JavaScript -->
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    populateSessionsTable();
    setupFilters();
    checkActiveSession();
  });

  function populateSessionsTable() {
    const sessions = PokerTracker.DataStore.getSessions();
    const tbody = document.getElementById('sessionsTableBody');
    const cardContainer = document.getElementById('sessionsCardContainer');

    // Populate table (desktop)
    tbody.innerHTML = sessions.map(session => {
      const game = PokerTracker.DataStore.getGame(session.gameId);
      const profit = (session.cashOut || 0) - (session.buyIn || 0);

      // Get hands count and VPIP directly from session
      const handsCount = session.total || 0;
      const vpip = (session.vpip || 0).toFixed(1);

      // Calculate duration from start/end time or estimate
      let duration = 0;
      if (session.startTime && session.endTime) {
        duration = Math.round((new Date(session.endTime) - new Date(session.startTime)) / (1000 * 60));
      } else if (session.startTime) {
        duration = Math.round((new Date() - new Date(session.startTime)) / (1000 * 60));
      } else if (handsCount > 0) {
        duration = handsCount * 2; // Estimate 2 minutes per hand
      }

      return `
        <tr>
          <td>${session.date}</td>
          <td>${game?.name || 'Unknown'}</td>
          <td>${duration > 0 ? PokerTracker.Utils.formatDuration(duration) : '-'}</td>
          <td>${PokerTracker.Utils.formatCurrency(session.buyIn || 0)}</td>
          <td>${PokerTracker.Utils.formatCurrency(session.cashOut || 0)}</td>
          <td class="${profit >= 0 ? 'positive' : 'negative'}">${profit >= 0 ? '+' : ''}${PokerTracker.Utils.formatCurrency(profit)}</td>
          <td>${handsCount}</td>
          <td>${vpip}%</td>
          <td>
            <div class="session-actions">
              <button class="action-menu-btn" onclick="console.log('Button clicked!'); showActionMenu(this, '${session.id}')">⋮</button>
            </div>
          </td>
        </tr>
      `;
    }).join('');

    // Populate cards (mobile)
    cardContainer.innerHTML = sessions.map(session => {
      const game = PokerTracker.DataStore.getGame(session.gameId);
      const profit = (session.cashOut || 0) - (session.buyIn || 0);

      // Get hands count and VPIP directly from session
      const handsCount = session.total || 0;
      const vpip = (session.vpip || 0).toFixed(1);

      return `
        <div class="session-card">
          <div class="session-card-content">
            <div class="session-card-info">
              <span class="session-card-title">${game?.name || 'Unknown'}</span>
              <span class="session-card-pnl ${profit >= 0 ? 'positive' : 'negative'}">
                ${profit >= 0 ? '+' : ''}${PokerTracker.Utils.formatCurrency(profit)}
              </span>
            </div>
            <div class="session-card-info">
              <span class="session-card-date">${session.date}</span>
              <span class="session-card-vpip">VPIP: ${vpip}%</span>
            </div>
          </div>
          <div class="session-card-actions">
            <button class="action-menu-btn" onclick="showActionMenu(this, '${session.id}')">⋮</button>
          </div>
        </div>
      `;
    }).join('');
  }

  function deleteSession(sessionId) {
    const session = PokerTracker.DataStore.getSession(sessionId);
    if (!session) {
      alert('Session not found');
      return;
    }

    const handsCount = session.total || 0;

    if (confirm(`Are you sure you want to delete this session? This will permanently delete ${handsCount} hands and cannot be undone.`)) {
      PokerTracker.DataStore.deleteSession(sessionId);
      alert('Session deleted successfully!');
      populateSessionsTable();
      checkActiveSession();
    }
  }

  function setupFilters() {
    // Add filter functionality here
    const filters = ['sessionSearch', 'gameFilter', 'dateFrom', 'dateTo', 'profitFilter'];
    filters.forEach(filterId => {
      document.getElementById(filterId).addEventListener('change', applyFilters);
      document.getElementById(filterId).addEventListener('input', applyFilters);
    });
  }

  function applyFilters() {
    // Filter implementation would go here
    console.log('Applying filters...');
  }

  function viewSession(sessionId) {
    window.location.href = `/projects/poker_tracker/session?session_id=${sessionId}`;
  }

  function editSession(sessionId) {
    PokerTracker.SessionModal.showSessionSettingsModal(sessionId);
  }

  function goToActiveSession() {
    const activeSession = PokerTracker.DataStore.getActiveSession();
    if (activeSession) {
      window.location.href = `/projects/poker_tracker/session?session_id=${activeSession.id}`;
    }
  }

  function checkActiveSession() {
    const activeSession = PokerTracker.DataStore.getActiveSession();
    const liveSessionBtn = document.getElementById('liveSessionBtn');

    if (activeSession) {
      liveSessionBtn.className = 'btn btn-live-active';
      liveSessionBtn.disabled = false;
      liveSessionBtn.textContent = 'Live';
    } else {
      liveSessionBtn.className = 'btn btn-live-disabled';
      liveSessionBtn.disabled = true;
      liveSessionBtn.textContent = 'Live';
    }
  }
</script>

<!-- Shared JavaScript -->
<script src="assets/js/data-store.js"></script>
<script src="assets/js/app.js"></script>

<script>
  function quickAction() {
    alert('Quick Action - Could start new session, add hand, or quick access menu');
  }


  let currentActionSessionId = null;
  let menuShowTime = 0;

  function showActionMenu(button, sessionId) {
    console.log('showActionMenu called', sessionId);
    const menu = document.getElementById('actionMenu');

    if (!menu) {
      console.error('Menu element not found');
      return;
    }

    // Check if menu is already open for the same session
    if (currentActionSessionId === sessionId && menu.classList.contains('show')) {
      console.log('Menu already open for this session, hiding it');
      hideActionMenu();
      return;
    }

    // Close any existing menu first
    menu.classList.remove('show');

    menuShowTime = Date.now(); // Record when menu was shown
    currentActionSessionId = sessionId;

    // Position menu above the button
    const buttonRect = button.getBoundingClientRect();
    console.log('Button rect:', buttonRect);
    console.log('Window size:', window.innerWidth, window.innerHeight);

    // Reset any previous styles
    menu.style.position = 'fixed';
    menu.style.top = 'auto';
    menu.style.right = 'auto';
    menu.style.bottom = 'auto';
    menu.style.transform = 'none';

    // Calculate position above the button
    const menuHeight = 140; // Approximate height of menu with 3 items
    const spaceAbove = buttonRect.top;
    const spaceBelow = window.innerHeight - buttonRect.bottom;

    if (spaceAbove >= menuHeight + 8) {
      // Position above button
      menu.style.bottom = (window.innerHeight - buttonRect.top + 8) + 'px';
      console.log('Positioning above, bottom:', menu.style.bottom);
    } else {
      // Position below button if not enough space above
      menu.style.top = (buttonRect.bottom + 8) + 'px';
      console.log('Positioning below, top:', menu.style.top);
    }

    // Horizontal positioning - keep menu within viewport
    let leftPos = buttonRect.left - 60;
    const menuWidth = 140;

    // Ensure menu doesn't go off the right edge
    if (leftPos + menuWidth > window.innerWidth - 16) {
      leftPos = window.innerWidth - menuWidth - 16;
    }

    // Ensure menu doesn't go off the left edge
    if (leftPos < 16) {
      leftPos = 16;
    }

    menu.style.left = leftPos + 'px';
    console.log('Final position - left:', leftPos, 'menu width:', menuWidth);

    // Show the menu
    menu.classList.add('show');
    console.log('Menu should be visible now, has show class:', menu.classList.contains('show'));
  }

  function hideActionMenu() {
    console.log("hide action menu called")
    const menu = document.getElementById('actionMenu');

    menu.classList.remove('show');
    currentActionSessionId = null;
    menuShowTime = 0; // Reset the show time
  }

  function executeAction(action) {
    if (!currentActionSessionId) return;

    hideActionMenu();

    switch(action) {
      case 'view':
        viewSession(currentActionSessionId);
        break;
      case 'edit':
        editSession(currentActionSessionId);
        break;
      case 'delete':
        deleteSession(currentActionSessionId);
        break;
    }
  }

  // Close action menu when clicking outside
  document.addEventListener('click', function(e) {
    console.log("clicked outside")

    // Debounce: don't hide menu if it was just shown (within 300ms)
    const timeSinceShow = Date.now() - menuShowTime;
    if (timeSinceShow < 10) {
      console.log("Ignoring click outside - menu was just shown", timeSinceShow + "ms ago");
      return;
    }

    if (!e.target.closest('.session-actions') && !e.target.closest('.action-menu-popup')) {
      hideActionMenu();
    }
  });

</script>

{% include_relative components/new-session-modal.html %}
{% include_relative components/new-game-modal.html %}
{% include_relative components/session-settings-modal.html %}

<!-- Action Menu -->
<div id="actionMenu" class="action-menu-popup">
  <button class="action-menu-item" onclick="executeAction('view')">
    <span>View</span>
  </button>
  <button class="action-menu-item" onclick="executeAction('edit')">
    <span>Edit</span>
  </button>
  <button class="action-menu-item delete" onclick="executeAction('delete')">
    <span>Delete</span>
  </button>
</div>

    </div>
  </main>
</body>
</html>