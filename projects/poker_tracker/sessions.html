---
title: PokerTracker - Sessions
nav_id: sessions
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>{{ page.title | default: "PokerTracker" }}</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  {% include_relative components/nav-bar.html %}

  <main>
    <div class="container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Sessions</h1>
    <div style="display: flex; gap: 1rem;">
      <button class="btn" onclick="goToActiveSession()" id="liveSessionBtn">Live Session</button>
      <button class="btn btn-primary" onclick="PokerTracker.Modal.showNewSessionModal()">+ New Session</button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <div class="filter-field">
      <label class="filter-label" for="sessionSearch">Session Name</label>
      <input type="text" class="filter-input" placeholder="Name contains" id="sessionSearch">
    </div>
    <div class="filter-field">
      <label class="filter-label" for="gameFilter">Game</label>
      <select class="filter-input" id="gameFilter">
        <option value="">All Games</option>
      </select>
    </div>
    <div class="filter-field">
      <label class="filter-label" for="dateFrom">From Date</label>
      <input type="date" class="filter-input" id="dateFrom">
    </div>
    <div class="filter-field">
      <label class="filter-label" for="dateTo">To Date</label>
      <input type="date" class="filter-input" id="dateTo">
    </div>
    <div class="filter-field">
      <label class="filter-label" for="profitFilter">Results</label>
      <select class="filter-input" id="profitFilter">
        <option value="">All Results</option>
        <option value="positive">Winning Sessions</option>
        <option value="negative">Losing Sessions</option>
      </select>
    </div>
    <div class="filter-field filter-button">
      <button type="button" class="btn btn-primary session-filter-apply" id="sessionFilterApplyBtn" aria-label="Apply session filters">Search</button>
    </div>
  </div>

  <!-- Sessions Table (Desktop) -->
  <div class="card desktop-view">
    <div class="card-content">
      <div class="table-container">
        <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Session</th>
            <th>Game</th>
            <th>Duration</th>
            <th>Buy-in</th>
            <th>Cash-out</th>
            <th>P&L</th>
            <th>Hands</th>
            <th>VPIP</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="sessionsTableBody">
          <!-- Populated by JavaScript -->
        </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Sessions Cards (Mobile) -->
  <div class="mobile-view">
    <div id="sessionsCardContainer">
      <!-- Populated by JavaScript -->
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    populateGameFilter();
    renderSessions();
    setupFilters();
    checkActiveSession();

    document.addEventListener('pokertracker:live-session-change', function() {
      checkActiveSession();
      populateGameFilter();
      applyFilters();
    });
  });

  function renderSessions(sessions = PokerTracker.DataStore.getSessions()) {
    const tbody = document.getElementById('sessionsTableBody');
    const cardContainer = document.getElementById('sessionsCardContainer');

    if (!tbody || !cardContainer) return;

    const orderedSessions = [...sessions].sort((a, b) => {
      const valueA = PokerTracker.DataStore.getSessionSortValue(a);
      const valueB = PokerTracker.DataStore.getSessionSortValue(b);
      return valueB - valueA; // Most recent first
    });

    if (orderedSessions.length === 0) {
      tbody.innerHTML = '<tr><td colspan="10" class="sessions-empty">No sessions match the current filters.</td></tr>';
      cardContainer.innerHTML = '<div class="sessions-empty">No sessions match the current filters.</div>';
      return;
    }

    tbody.innerHTML = orderedSessions.map(session => {
      const game = PokerTracker.DataStore.getGame(session.gameId);
      const profit = (session.cashOut || 0) - (session.buyIn || 0);
      const handsCount = session.total || 0;
      const vpip = (session.vpip || 0).toFixed(1);
      const sessionDate = PokerTracker.DataStore.getSessionDate(session);

      let duration = 0;
      if (session.startTime && session.endTime) {
        duration = Math.round((new Date(session.endTime) - new Date(session.startTime)) / (1000 * 60));
      } else if (session.startTime) {
        duration = Math.round((new Date() - new Date(session.startTime)) / (1000 * 60));
      } else if (handsCount > 0) {
        duration = handsCount * 2;
      }

      const sessionName = session.name;

      return `
        <tr>
          <td>${sessionDate || '-'}</td>
          <td>${sessionName || '-'}</td>
          <td>${game?.name || '-'}</td>
          <td>${duration > 0 ? PokerTracker.Utils.formatDuration(duration) : '-'}</td>
          <td>${PokerTracker.Utils.formatCurrency(session.buyIn || 0)}</td>
          <td>${PokerTracker.Utils.formatCurrency(session.cashOut || 0)}</td>
          <td class="${profit >= 0 ? 'positive' : 'negative'}">${profit >= 0 ? '+' : ''}${PokerTracker.Utils.formatCurrency(profit)}</td>
          <td>${handsCount}</td>
          <td>${vpip}%</td>
          <td>
            <div class="session-actions">
              <button class="action-menu-btn" onclick="showActionMenu(this, '${session.id}')">⋮</button>
            </div>
          </td>
        </tr>
      `;
    }).join('');

    cardContainer.innerHTML = orderedSessions.map(session => {
      const game = PokerTracker.DataStore.getGame(session.gameId);
      const profit = (session.cashOut || 0) - (session.buyIn || 0);
      const sessionDate = PokerTracker.DataStore.getSessionDate(session);
      const sessionName = session.name;

      return `
        <div class="session-card">
          <div class="session-card-content">
            <div class="session-card-top">
              <span class="session-card-title">${sessionName || '-'}</span>
              <span class="session-card-game">${game?.name || '-'}</span>
            </div>
            <div class="session-card-bottom">
              <span class="session-card-date">${sessionDate || '-'}</span>
              <span class="session-card-pnl ${profit >= 0 ? 'positive' : 'negative'}">
                ${profit >= 0 ? '+' : ''}${PokerTracker.Utils.formatCurrency(profit)}
              </span>
            </div>
          </div>
          <div class="session-card-actions session-actions">
            <button class="action-menu-btn" onclick="showActionMenu(this, '${session.id}')">⋮</button>
          </div>
        </div>
      `;
    }).join('');
  }

  window.populateSessionsTable = renderSessions;

  function deleteSession(sessionId) {
    console.log('deleteSession called with sessionId:', sessionId);
    const session = PokerTracker.DataStore.getSession(sessionId);
    console.log('Retrieved session:', session);

    if (!session) {
      console.error('Session not found for ID:', sessionId);
      console.error('Session not found');
      return;
    }

    const handsCount = session.total || 0;

    if (confirm(`Are you sure you want to delete this session? This will permanently delete ${handsCount} hands and cannot be undone.`)) {
      PokerTracker.DataStore.deleteSession(sessionId);
      console.error('Session deleted successfully!');
      applyFilters();
      checkActiveSession();
    }
  }

  function setupFilters() {
    const applyButton = document.getElementById('sessionFilterApplyBtn');
    if (applyButton) {
      applyButton.addEventListener('click', applyFilters);
    }

    ['sessionSearch', 'dateFrom', 'dateTo'].forEach(id => {
      const input = document.getElementById(id);
      if (input) {
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            applyFilters();
          }
        });
      }
    });
  }

  function populateGameFilter() {
    const gameSelect = document.getElementById('gameFilter');
    if (!gameSelect) return;

    const previousValue = gameSelect.value;
    const games = PokerTracker.DataStore.getAllGames();
    const sessions = PokerTracker.DataStore.getSessions();
    const hasUngroupedSessions = sessions.some(session => !session.gameId);

    gameSelect.innerHTML = '';

    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'All Games';
    gameSelect.appendChild(defaultOption);

    games
      .slice()
      .sort((a, b) => a.name.localeCompare(b.name))
      .forEach(game => {
        const option = document.createElement('option');
        option.value = game.id;
        const location = game.location ? ` (${game.location})` : '';
        option.textContent = `${game.name}${location}`;
        gameSelect.appendChild(option);
      });

    if (hasUngroupedSessions) {
      const noGameOption = document.createElement('option');
      noGameOption.value = '__no_game__';
      noGameOption.textContent = 'No Game';
      gameSelect.appendChild(noGameOption);
    }

    if (previousValue && gameSelect.querySelector(`option[value="${previousValue}"]`)) {
      gameSelect.value = previousValue;
    }
  }

  function getFilteredSessions() {
    const nameFilter = document.getElementById('sessionSearch').value.trim().toLowerCase();
    const gameFilter = document.getElementById('gameFilter').value;
    const dateFrom = document.getElementById('dateFrom').value;
    const dateTo = document.getElementById('dateTo').value;
    const profitFilter = document.getElementById('profitFilter').value;

    const sessions = PokerTracker.DataStore.getSessions();
    const games = PokerTracker.DataStore.getAllGames();
    const gamesById = {};
    games.forEach(game => { gamesById[game.id] = game; });

    return sessions.filter(session => {
      const game = gamesById[session.gameId] || null;
      const sessionDate = PokerTracker.DataStore.getSessionDate(session);

      if (nameFilter) {
        const sessionName = (session.name || '').toLowerCase();
        const gameName = (game?.name || '').toLowerCase();
        if (!sessionName.includes(nameFilter) && !gameName.includes(nameFilter)) {
          return false;
        }
      }

      if (gameFilter) {
        if (gameFilter === '__no_game__') {
          if (session.gameId) return false;
        } else if (session.gameId !== gameFilter) {
          return false;
        }
      }

      if (dateFrom && (!sessionDate || sessionDate < dateFrom)) {
        return false;
      }

      if (dateTo && (!sessionDate || sessionDate > dateTo)) {
        return false;
      }

      const profit = (session.cashOut || 0) - (session.buyIn || 0);
      if (profitFilter === 'positive' && profit <= 0) {
        return false;
      }
      if (profitFilter === 'negative' && profit >= 0) {
        return false;
      }

      return true;
    });
  }

  function applyFilters() {
    const filteredSessions = getFilteredSessions();
    renderSessions(filteredSessions);
  }

  function viewSession(sessionId) {
    const sessionRoute = (PokerTracker.routes && PokerTracker.routes.session) || `{{ site.baseurl }}{% link projects/poker_tracker/session.html %}`;
    window.location.href = `${sessionRoute}?session_id=${sessionId}`;
  }

  function editSession(sessionId) {
    PokerTracker.SessionModal.showSessionSettingsModal(sessionId);
  }

  function goToActiveSession() {
    const activeSession = PokerTracker.DataStore.getActiveSession();
    if (activeSession) {
      const sessionRoute = (PokerTracker.routes && PokerTracker.routes.session) || `{{ site.baseurl }}{% link projects/poker_tracker/session.html %}`;
      window.location.href = `${sessionRoute}?session_id=${activeSession.id}`;
    }
  }

  function checkActiveSession() {
    if (typeof PokerTracker === 'undefined' || !PokerTracker.DataStore) return;

    const activeSession = PokerTracker.DataStore.getActiveSession();
    const liveSessionBtn = document.getElementById('liveSessionBtn');
    if (!liveSessionBtn) return;

    if (activeSession) {
      liveSessionBtn.className = 'btn btn-live-active';
      liveSessionBtn.disabled = false;
      liveSessionBtn.textContent = 'Live';
      liveSessionBtn.title = 'Go to live session';
    } else {
      liveSessionBtn.className = 'btn btn-live-disabled';
      liveSessionBtn.disabled = true;
      liveSessionBtn.textContent = 'Live';
      liveSessionBtn.title = 'No live session in progress';
    }
  }
</script>

<!-- Shared JavaScript -->
<script src="assets/js/data-store.js"></script>
<script src="assets/js/app.js"></script>

<script>
  function quickAction() {
    console.error('Quick Action - Could start new session, add hand, or quick access menu');
  }


  function showActionMenu(button, sessionId) {
    console.log('showActionMenu called', sessionId);
    const menu = document.getElementById('actionMenu');

    if (!menu) {
      console.error('Menu element not found');
      return;
    }

    // Check if menu is already open for the same session
    if (menu.classList.contains('show') && menu.dataset.sessionId === sessionId) {
      console.log('Menu already open for this session, hiding it');
      hideActionMenu();
      return;
    }

    // Close any existing menu first
    menu.classList.remove('show');

    menu.dataset.sessionId = sessionId; // Track which session this menu is for

    // Position menu above the button
    const buttonRect = button.getBoundingClientRect();
    console.log('Button rect:', buttonRect);
    console.log('Window size:', window.innerWidth, window.innerHeight);

    // Reset any previous styles
    menu.style.position = 'fixed';
    menu.style.top = 'auto';
    menu.style.right = 'auto';
    menu.style.bottom = 'auto';
    menu.style.transform = 'none';

    // Calculate position above the button
    const menuHeight = 140; // Approximate height of menu with 3 items
    const spaceAbove = buttonRect.top;
    const spaceBelow = window.innerHeight - buttonRect.bottom;

    if (spaceAbove >= menuHeight + 8) {
      // Position above button
      menu.style.bottom = (window.innerHeight - buttonRect.top + 8) + 'px';
      console.log('Positioning above, bottom:', menu.style.bottom);
    } else {
      // Position below button if not enough space above
      menu.style.top = (buttonRect.bottom + 8) + 'px';
      console.log('Positioning below, top:', menu.style.top);
    }

    // Horizontal positioning - keep menu within viewport
    let leftPos = buttonRect.left - 60;
    const menuWidth = 140;

    // Ensure menu doesn't go off the right edge
    if (leftPos + menuWidth > window.innerWidth - 16) {
      leftPos = window.innerWidth - menuWidth - 16;
    }

    // Ensure menu doesn't go off the left edge
    if (leftPos < 16) {
      leftPos = 16;
    }

    menu.style.left = leftPos + 'px';
    console.log('Final position - left:', leftPos, 'menu width:', menuWidth);

    // Update menu HTML with current session ID
    menu.innerHTML = `
      <button class="action-menu-item" onclick="executeAction('view', '${sessionId}')">
        <span>View</span>
      </button>
      <button class="action-menu-item" onclick="executeAction('edit', '${sessionId}')">
        <span>Edit</span>
      </button>
      <button class="action-menu-item delete" onclick="executeAction('delete', '${sessionId}')">
        <span>Delete</span>
      </button>
    `;

    // Show the menu
    menu.classList.add('show');
    console.log('Menu should be visible now, has show class:', menu.classList.contains('show'));
  }

  function hideActionMenu() {
    console.log("hide action menu called")
    const menu = document.getElementById('actionMenu');

    menu.classList.remove('show');
    delete menu.dataset.sessionId; // Clear the session ID
  }

  function executeAction(action, sessionId) {
    console.log('executeAction called with:', action, 'sessionId:', sessionId);

    if (!sessionId) {
      console.error('No session ID provided');
      return;
    }

    hideActionMenu();

    switch(action) {
      case 'view':
        console.log('Calling viewSession with:', sessionId);
        viewSession(sessionId);
        break;
      case 'edit':
        console.log('Calling editSession with:', sessionId);
        editSession(sessionId);
        break;
      case 'delete':
        console.log('Calling deleteSession with:', sessionId);
        deleteSession(sessionId);
        break;
    }
  }

  // Close action menu when clicking outside
  document.addEventListener('click', function(e) {
    console.log("clicked outside")

    if (!e.target.closest('.session-actions') && !e.target.closest('.action-menu-popup')) {
      hideActionMenu();
    }
  });

</script>

{% include_relative components/new-session-modal.html %}
{% include_relative components/new-game-modal.html %}
{% include_relative components/session-settings-modal.html %}

<!-- Action Menu -->
<div id="actionMenu" class="action-menu-popup">
  <!-- Menu items are dynamically generated with session ID -->
</div>

    </div>
  </main>
</body>
</html>
