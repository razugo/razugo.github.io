---
title: PokerTracker - Bankroll
nav_id: bankroll
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>{{ page.title | default: "PokerTracker" }}</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slim-select@2/dist/slimselect.min.css">
  <link rel="stylesheet" href="{{ '/projects/poker_tracker/assets/styles/main.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/projects/poker_tracker/assets/styles/nav-bar.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/projects/poker_tracker/assets/styles/datetime-picker.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/projects/poker_tracker/assets/styles/new-session-modal.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/projects/poker_tracker/bankroll/bankroll.css' | relative_url }}">
</head>
<body>
  <div class="nav-container" data-component="nav-bar" data-active="{{ page.nav_id | default: '' }}" data-base="{{ '/projects/poker_tracker' | relative_url }}">
  <nav class="nav">
    <a href="{{ '/projects/poker_tracker/' | relative_url }}" class="nav-brand">PokerTracker</a>
    <ul class="nav-menu">
      <li><a href="#" class="nav-link live-session-btn">Live Session</a></li>
      <li><a href="{{ '/projects/poker_tracker/' | relative_url }}" class="nav-link{% if page.nav_id == 'dashboard' %} active{% endif %}" data-nav-id="dashboard">Dashboard</a></li>
      <li><a href="{{ '/projects/poker_tracker/bankroll/' | relative_url }}" class="nav-link{% if page.nav_id == 'bankroll' %} active{% endif %}" data-nav-id="bankroll">Bankroll</a></li>
      <li><a href="{{ '/projects/poker_tracker/sessions/' | relative_url }}" class="nav-link{% if page.nav_id == 'sessions' %} active{% endif %}" data-nav-id="sessions">Sessions</a></li>
      <li><a href="{{ '/projects/poker_tracker/tools/' | relative_url }}" class="nav-link{% if page.nav_id == 'tools' %} active{% endif %}" data-nav-id="tools">Tools</a></li>
    </ul>
    <button class="nav-toggle" aria-label="Toggle navigation">â˜°</button>
  </nav>
</div>

  <main>
    <div class="container">
      <h1>Bankroll Dashboard</h1>

      <!-- Filters -->
      <div class="session-filters">
        <div class="filter-group">
          <label>FROM DATE</label>
          <input type="text" id="dateFromFilter" class="filter-input datetime-picker-input" placeholder="YYYY-MM-DD" readonly>
        </div>
        <div class="filter-group">
          <label>TO DATE</label>
          <input type="text" id="dateToFilter" class="filter-input datetime-picker-input" placeholder="YYYY-MM-DD" readonly>
        </div>
        <div class="filter-group">
          <label>LOCATION</label>
          <select id="locationFilter" class="filter-select">
            <option value="">All locations</option>
          </select>
        </div>
        <div class="filter-group">
          <label>STAKES</label>
          <select id="stakesFilter" class="filter-select">
            <option value="">All stakes</option>
          </select>
        </div>
        <button id="clearButton" class="filter-btn">Clear</button>
      </div>

      <!-- KPI Cards -->
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-title">Total Profit</div>
          <div class="kpi-value" id="totalProfitKPI">$0</div>
          <div class="kpi-subtitle" id="totalProfitBBKPI">0 BB</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-title">Hourly Win Rate</div>
          <div class="kpi-value" id="hourlyWinRateKPI">$0/hr</div>
          <div class="kpi-subtitle" id="hourlyWinRateBBKPI">0 BB/hr</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-title">Total Sessions</div>
          <div class="kpi-value" id="totalSessionsKPI">0</div>
          <div class="kpi-subtitle" id="totalHoursKPI">0 hours played</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-title">Overall Winrate</div>
          <div class="kpi-value" id="overallWinrateKPI">0 BB/hr</div>
          <div class="kpi-subtitle" id="winPercentKPI">0% win rate</div>
        </div>
      </div>

      <!-- Charts -->
      <div class="charts-container">
        <!-- Bankroll -->
        <div class="card chart-card">
          <div class="card-header">
            <h2 class="card-title">Bankroll</h2>
            <div class="chart-toggle">
              <button id="chartAxisToggle" class="toggle-btn" title="Toggle between date and session view">
                <span class="toggle-option" data-mode="date">Date</span>
                <span class="toggle-option active" data-mode="session">Session</span>
              </button>
            </div>
          </div>
          <div class="card-content">
            <div class="chart-container">
              <canvas id="bankrollOverTimeChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
          <div class="card chart-card">
            <div class="card-header">
              <h3 class="card-title">Profit by Room</h3>
            </div>
            <div class="card-content">
              <div class="chart-container chart-container-small">
                <canvas id="profitByRoomChart"></canvas>
              </div>
            </div>
          </div>

          <div class="card chart-card">
            <div class="card-header">
              <h3 class="card-title">Hourly by Stake</h3>
            </div>
            <div class="card-content">
              <div class="chart-container chart-container-small">
                <canvas id="hourlyByStakeChart"></canvas>
              </div>
            </div>
          </div>

          <div class="card chart-card">
            <div class="card-header">
              <h3 class="card-title">Profit by Day of Week</h3>
            </div>
            <div class="card-content">
              <div class="chart-container chart-container-small">
                <canvas id="profitByDayChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

<script>
  let bankrollOverTimeChart = null;
  let profitByRoomChart = null;
  let hourlyByStakeChart = null;
  let profitByDayChart = null;

  const currentFilters = {
    dateFrom: '',
    dateTo: '',
    location: '',
    stakes: ''
  };

  let chartAxisMode = 'session'; // 'date' or 'session'

  document.addEventListener('DOMContentLoaded', function() {
    populateFilterOptions();
    setupEventListeners();
    setupDatePickers();
    updateDashboard();
  });

  document.addEventListener('pokertracker:session-data-change', function() {
    updateDashboard();
  });

  function setupEventListeners() {
    // Filter event listeners for date inputs (will be triggered by datetime-picker)
    document.getElementById('dateFromFilter').addEventListener('change', (e) => {
      currentFilters.dateFrom = e.target.value;
      updateDashboard();
    });

    document.getElementById('dateToFilter').addEventListener('change', (e) => {
      currentFilters.dateTo = e.target.value;
      updateDashboard();
    });

    document.getElementById('locationFilter').addEventListener('change', (e) => {
      currentFilters.location = e.target.value;
      updateDashboard();
    });

    document.getElementById('stakesFilter').addEventListener('change', (e) => {
      currentFilters.stakes = e.target.value;
      updateDashboard();
    });

    document.getElementById('clearButton').addEventListener('click', () => {
      clearFilters();
    });

    // Chart axis toggle event listener
    document.getElementById('chartAxisToggle').addEventListener('click', (e) => {
      const target = e.target.closest('.toggle-option');
      if (target && target.dataset.mode !== chartAxisMode) {
        // Update mode
        chartAxisMode = target.dataset.mode;

        // Update UI
        document.querySelectorAll('.toggle-option').forEach(option => {
          option.classList.remove('active');
        });
        target.classList.add('active');

        // Update chart
        const filteredSessions = getFilteredSessions();
        updateBankrollOverTimeChart(filteredSessions);
      }
    });
  }

  function setupDatePickers() {
    // Initialize datetime-picker for date-only selection
    PokerTracker.DateTimePicker.attachToInput('#dateFromFilter', {
      includeTime: false,
      onConfirm: (value) => {
        currentFilters.dateFrom = value || '';
        updateDashboard();
      }
    });

    PokerTracker.DateTimePicker.attachToInput('#dateToFilter', {
      includeTime: false,
      onConfirm: (value) => {
        currentFilters.dateTo = value || '';
        updateDashboard();
      }
    });
  }

  function updateDashboard() {
    const filteredSessions = getFilteredSessions();
    updateKPIs(filteredSessions);
    updateCharts(filteredSessions);
  }

  function clearFilters() {
    currentFilters.dateFrom = '';
    currentFilters.dateTo = '';
    currentFilters.location = '';
    currentFilters.stakes = '';

    document.getElementById('dateFromFilter').value = '';
    document.getElementById('dateToFilter').value = '';
    document.getElementById('locationFilter').value = '';
    document.getElementById('stakesFilter').value = '';

    updateDashboard();
  }

  function populateFilterOptions() {
    const sessions = PokerTracker.DataStore.getSessions();

    // Populate locations
    const locations = [...new Set(sessions.map(s => s.location).filter(Boolean))].sort();
    const locationSelect = document.getElementById('locationFilter');
    locationSelect.innerHTML = '<option value="">All locations</option>';
    locations.forEach(location => {
      const option = document.createElement('option');
      option.value = location;
      option.textContent = location;
      locationSelect.appendChild(option);
    });

    // Populate stakes
    const stakes = [...new Set(sessions.map(s => {
      if (s.smallBlind && s.bigBlind) {
        return `${s.smallBlind}/${s.bigBlind}`;
      }
      return null;
    }).filter(Boolean))].sort((a, b) => {
      const [aSmall] = a.split('/').map(Number);
      const [bSmall] = b.split('/').map(Number);
      return aSmall - bSmall;
    });

    const stakesSelect = document.getElementById('stakesFilter');
    stakesSelect.innerHTML = '<option value="">All stakes</option>';
    stakes.forEach(stake => {
      const option = document.createElement('option');
      option.value = stake;
      option.textContent = `$${stake}`;
      stakesSelect.appendChild(option);
    });
  }

  function getFilteredSessions() {
    let sessions = PokerTracker.DataStore.getSessions();

    // Filter by stakes
    if (currentFilters.stakes) {
      sessions = sessions.filter(session => {
        if (!session.smallBlind || !session.bigBlind) return false;
        const stake = `${session.smallBlind}/${session.bigBlind}`;
        return stake === currentFilters.stakes;
      });
    }

    // Filter by location
    if (currentFilters.location) {
      sessions = sessions.filter(session => session.location === currentFilters.location);
    }

    // Filter by date range
    if (currentFilters.dateFrom || currentFilters.dateTo) {
      sessions = sessions.filter(session => {
        const sessionDate = PokerTracker.DataStore.getSessionDate(session);
        if (!sessionDate) return false;

        const date = new Date(sessionDate);

        if (currentFilters.dateFrom && date < new Date(currentFilters.dateFrom)) {
          return false;
        }

        if (currentFilters.dateTo && date > new Date(currentFilters.dateTo)) {
          return false;
        }

        return true;
      });
    }


    return sessions;
  }

  function updateKPIs(sessions) {
    const stats = calculateStats(sessions);

    // Total Profit
    document.getElementById('totalProfitKPI').textContent = PokerTracker.Utils.formatCurrency(stats.totalProfit);
    document.getElementById('totalProfitKPI').className = `kpi-value ${stats.totalProfit >= 0 ? 'positive' : 'negative'}`;
    document.getElementById('totalProfitBBKPI').textContent = `${stats.totalProfitBB} BB`;

    // Hourly Win Rate
    document.getElementById('hourlyWinRateKPI').textContent = `${PokerTracker.Utils.formatCurrency(stats.hourlyRate)}/hr`;
    document.getElementById('hourlyWinRateKPI').className = `kpi-value ${stats.hourlyRate >= 0 ? 'positive' : 'negative'}`;
    document.getElementById('hourlyWinRateBBKPI').textContent = `${stats.hourlyRateBB} BB/hr`;

    // Total Sessions
    document.getElementById('totalSessionsKPI').textContent = stats.totalSessions;
    document.getElementById('totalHoursKPI').textContent = `${stats.totalHours} hours played`;

    // Overall Winrate
    document.getElementById('overallWinrateKPI').textContent = `${stats.hourlyRateBB} BB/hr`;
    document.getElementById('overallWinrateKPI').className = `kpi-value ${stats.hourlyRateBB >= 0 ? 'positive' : 'negative'}`;
    document.getElementById('winPercentKPI').textContent = `${stats.winRate}% win rate`;
  }

  function calculateStats(sessions) {
    const totalSessions = sessions.length;

    if (totalSessions === 0) {
      return {
        totalProfit: 0,
        totalProfitBB: 0,
        hourlyRate: 0,
        hourlyRateBB: 0,
        totalSessions: 0,
        totalHours: 0,
        winRate: 0
      };
    }

    // Calculate total profit from all sessions
    const totalProfit = sessions.reduce((sum, session) => {
      const profit = (session.cashOut || 0) - (session.buyIn || 0);
      return sum + profit;
    }, 0);

    // Calculate total hours from startTime/endTime
    const totalHours = sessions.reduce((sum, session) => {
      if (session.startTime && session.endTime) {
        const startTime = new Date(session.startTime);
        const endTime = new Date(session.endTime);
        const durationMs = endTime.getTime() - startTime.getTime();
        const durationHours = durationMs / (1000 * 60 * 60);
        if (durationHours > 0) {
          return sum + durationHours;
        }
      }
      // Fallback: estimate from hand count if no start/end time
      if (session.total && session.total > 0) {
        return sum + (session.total * 2 / 60); // Assume 2 minutes per hand
      }
      return sum;
    }, 0);

    // Calculate hourly rate
    const hourlyRate = totalHours > 0 ? totalProfit / totalHours : 0;

    // Calculate big blind stats (using weighted average based on hours played)
    let totalBBWeighted = 0;
    let totalWeightedHours = 0;

    sessions.forEach(session => {
      if (session.bigBlind && session.startTime && session.endTime) {
        const startTime = new Date(session.startTime);
        const endTime = new Date(session.endTime);
        const durationMs = endTime.getTime() - startTime.getTime();
        const sessionHours = durationMs / (1000 * 60 * 60);
        if (sessionHours > 0) {
          totalBBWeighted += session.bigBlind * sessionHours;
          totalWeightedHours += sessionHours;
        }
      }
    });

    // If no weighted data available, use simple average
    const avgBB = totalWeightedHours > 0
      ? totalBBWeighted / totalWeightedHours
      : sessions.filter(s => s.bigBlind).reduce((sum, s, _, arr) => sum + s.bigBlind / arr.length, 0) || 2;

    const totalProfitBB = Math.round(totalProfit / avgBB);
    const hourlyRateBB = totalHours > 0 ? Math.round((hourlyRate / avgBB) * 10) / 10 : 0;

    // Calculate win rate (percentage of winning sessions)
    const winningSessions = sessions.filter(session => {
      const profit = (session.cashOut || 0) - (session.buyIn || 0);
      return profit > 0;
    }).length;

    const winRate = Math.round((winningSessions / totalSessions) * 100);

    return {
      totalProfit: Math.round(totalProfit * 100) / 100,
      totalProfitBB,
      hourlyRate: Math.round(hourlyRate * 100) / 100,
      hourlyRateBB,
      totalSessions,
      totalHours: Math.round(totalHours * 10) / 10,
      winRate
    };
  }

  function updateCharts(sessions) {
    updateBankrollOverTimeChart(sessions);
    updateProfitByRoomChart(sessions);
    updateHourlyByStakeChart(sessions);
    updateProfitByDayChart(sessions);
  }

  function updateBankrollOverTimeChart(sessions) {
    const canvas = document.getElementById('bankrollOverTimeChart');
    if (!canvas) return;

    if (bankrollOverTimeChart) {
      bankrollOverTimeChart.destroy();
    }

    const sortedSessions = sessions.slice().sort((a, b) =>
      PokerTracker.DataStore.getSessionSortValue(a) - PokerTracker.DataStore.getSessionSortValue(b)
    );

    const chartData = [];
    let cumulative = 0;

    sortedSessions.forEach((session, index) => {
      const profit = (session.cashOut || 0) - (session.buyIn || 0);
      cumulative += profit;

      if (chartAxisMode === 'session') {
        // Use session index for session mode
        chartData.push({
          x: index + 1,
          y: cumulative
        });
      } else {
        // Use actual date for date mode
        const sessionDate = PokerTracker.DataStore.getSessionDate(session);
        if (sessionDate) {
          chartData.push({
            x: sessionDate,
            y: cumulative
          });
        }
      }
    });

    const chartConfig = {
      type: 'line',
      data: {
        datasets: [{
          label: 'Cumulative P&L',
          data: chartData,
          borderColor: '#1d4ed8',
          backgroundColor: 'rgba(37, 99, 235, 0.1)',
          fill: true,
          tension: 0.1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {},
          y: {
            ticks: {
              callback: function(value) {
                return PokerTracker.Utils.formatCurrency(value);
              }
            }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
    };

    // Configure x-axis based on mode
    if (chartAxisMode === 'session') {
      chartConfig.options.scales.x = {
        type: 'linear',
        title: {
          display: true,
          text: 'Session Number'
        },
        ticks: {
          stepSize: 1,
          callback: function(value) {
            return Number.isInteger(value) ? `Session ${value}` : '';
          }
        }
      };
    } else {
      chartConfig.options.scales.x = {
        type: 'time',
        time: {
          unit: 'day',
          displayFormats: {
            day: 'MMM dd'
          }
        },
        title: {
          display: true,
          text: 'Date'
        }
      };
    }

    bankrollOverTimeChart = new Chart(canvas, chartConfig);
  }

  function updateProfitByRoomChart(sessions) {
    const canvas = document.getElementById('profitByRoomChart');
    if (!canvas) return;

    if (profitByRoomChart) {
      profitByRoomChart.destroy();
    }

    const roomData = {};
    sessions.forEach(session => {
      const room = session.location || 'Unknown';
      const profit = (session.cashOut || 0) - (session.buyIn || 0);
      roomData[room] = (roomData[room] || 0) + profit;
    });

    const labels = Object.keys(roomData);
    const data = Object.values(roomData);

    profitByRoomChart = new Chart(canvas, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Profit',
          data,
          backgroundColor: data.map(profit => profit >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)'),
          borderColor: data.map(profit => profit >= 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)'),
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            ticks: {
              callback: function(value) {
                return PokerTracker.Utils.formatCurrency(value);
              }
            }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
    });
  }

  function updateHourlyByStakeChart(sessions) {
    const canvas = document.getElementById('hourlyByStakeChart');
    if (!canvas) return;

    if (hourlyByStakeChart) {
      hourlyByStakeChart.destroy();
    }

    const stakeData = {};
    const stakeHours = {};

    sessions.forEach(session => {
      if (!session.smallBlind || !session.bigBlind) return;

      const stake = `${session.smallBlind}/${session.bigBlind}`;
      const profit = (session.cashOut || 0) - (session.buyIn || 0);
      let hours = 0;

      if (session.startTime && session.endTime) {
        const startTime = new Date(session.startTime);
        const endTime = new Date(session.endTime);
        const durationMs = endTime.getTime() - startTime.getTime();
        const sessionHours = durationMs / (1000 * 60 * 60);
        if (sessionHours > 0) {
          hours = sessionHours;
        }
      } else if (session.total > 0) {
        hours = session.total * 2 / 60; // fallback estimation
      }

      stakeData[stake] = (stakeData[stake] || 0) + profit;
      stakeHours[stake] = (stakeHours[stake] || 0) + hours;
    });

    const labels = Object.keys(stakeData);
    const data = labels.map(stake => {
      const totalProfit = stakeData[stake];
      const totalHours = stakeHours[stake];
      return totalHours > 0 ? totalProfit / totalHours : 0;
    });

    hourlyByStakeChart = new Chart(canvas, {
      type: 'bar',
      data: {
        labels: labels.map(stake => `$${stake}`),
        datasets: [{
          label: 'Hourly Rate',
          data,
          backgroundColor: data.map(rate => rate >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)'),
          borderColor: data.map(rate => rate >= 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)'),
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            ticks: {
              callback: function(value) {
                return PokerTracker.Utils.formatCurrency(value) + '/hr';
              }
            }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
    });
  }

  function updateProfitByDayChart(sessions) {
    const canvas = document.getElementById('profitByDayChart');
    if (!canvas) return;

    if (profitByDayChart) {
      profitByDayChart.destroy();
    }

    const dayData = {
      'Monday': 0,
      'Tuesday': 0,
      'Wednesday': 0,
      'Thursday': 0,
      'Friday': 0,
      'Saturday': 0,
      'Sunday': 0
    };

    sessions.forEach(session => {
      const sessionDate = PokerTracker.DataStore.getSessionDate(session);
      if (!sessionDate) return;

      const date = new Date(sessionDate);
      const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
      const profit = (session.cashOut || 0) - (session.buyIn || 0);

      dayData[dayName] += profit;
    });

    const labels = Object.keys(dayData);
    const data = Object.values(dayData);

    profitByDayChart = new Chart(canvas, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Profit',
          data,
          backgroundColor: data.map(profit => profit >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)'),
          borderColor: data.map(profit => profit >= 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)'),
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            ticks: {
              callback: function(value) {
                return PokerTracker.Utils.formatCurrency(value);
              }
            }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
    });
  }
</script>

<div data-component="new-session-modal"></div>

<!-- Shared JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/slim-select@2/dist/slimselect.min.js"></script>
<script src="{{ '/projects/poker_tracker/assets/js/data-store.js' | relative_url }}"></script>
<script src="{{ '/projects/poker_tracker/assets/js/app.js' | relative_url }}"></script>
<script src="{{ '/projects/poker_tracker/assets/js/datetime-picker.js' | relative_url }}"></script>
<script src="{{ '/projects/poker_tracker/assets/js/nav-bar.js' | relative_url }}"></script>
<script src="{{ '/projects/poker_tracker/assets/js/new-session-modal.js' | relative_url }}"></script>

</body>
</html>
