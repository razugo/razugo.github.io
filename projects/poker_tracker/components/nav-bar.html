<!-- Navigation -->
<nav class="nav">
  <a href="{{ site.baseurl }}{% link projects/poker_tracker/index.html %}" class="nav-brand">PokerTracker</a>
  <ul class="nav-menu" id="navMenu">
    <li><a href="#" class="nav-link live-session-btn {% if page.nav_id == 'session' %}active{% endif %}" id="liveSessionNavLink">Live Session</a></li>
    <li><a href="{{ site.baseurl }}{% link projects/poker_tracker/index.html %}" class="nav-link {% if page.nav_id == 'dashboard' %}active{% endif %}">Dashboard</a></li>
    <li><a href="{{ site.baseurl }}{% link projects/poker_tracker/sessions.html %}" class="nav-link {% if page.nav_id == 'sessions' %}active{% endif %}">Sessions</a></li>
    <li><a href="{{ site.baseurl }}{% link projects/poker_tracker/games.html %}" class="nav-link {% if page.nav_id == 'games' %}active{% endif %}">Games</a></li>
    <li><a href="{{ site.baseurl }}{% link projects/poker_tracker/tools.html %}" class="nav-link {% if page.nav_id == 'tools' %}active{% endif %}">Tools</a></li>
  </ul>
  <button class="nav-toggle" id="navToggle">â˜°</button>
</nav>

<script>
  window.PokerTracker = window.PokerTracker || {};
  window.PokerTracker.routes = window.PokerTracker.routes || {};
  window.PokerTracker.routes.session = '{{ site.baseurl }}{% link projects/poker_tracker/session.html %}';

  // Mobile nav toggle
  document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.getElementById('navToggle');
    const navMenu = document.getElementById('navMenu');

    navToggle.addEventListener('click', () => {
      navMenu.classList.toggle('open');
    });

    // Close nav menu when clicking outside
    document.addEventListener('click', function(e) {
      // Don't close if clicking on the nav menu itself or the toggle button
      if (!navMenu.contains(e.target) && !navToggle.contains(e.target)) {
        navMenu.classList.remove('open');
      }
    });

    // Setup Live Session nav link
    setupLiveSessionNavLink();

    document.addEventListener('pokertracker:live-session-change', setupLiveSessionNavLink);
  });

  function setupLiveSessionNavLink() {
    const liveSessionLink = document.getElementById('liveSessionNavLink');
    if (!liveSessionLink) return;

    // Check if PokerTracker.DataStore is available
    if (typeof PokerTracker !== 'undefined' && PokerTracker.DataStore) {
      const activeSession = PokerTracker.DataStore.getActiveSession();

      liveSessionLink.classList.remove('live-session-start', 'live-session-active');

      if (activeSession) {
        // Live session is active - show "Go to Live Session" with active styling
        liveSessionLink.textContent = 'Live Session';
        liveSessionLink.href = `{{ site.baseurl }}{% link projects/poker_tracker/session.html %}?session_id=${activeSession.id}`;
        liveSessionLink.classList.add('live-session-active');
        liveSessionLink.style.opacity = '1';
        liveSessionLink.style.pointerEvents = 'auto';
        liveSessionLink.title = `Active session: ${activeSession.name || 'Unnamed Session'}`;
      } else {
        // No live session - show "+ Live Session" call to action
        liveSessionLink.textContent = '+ Live Session';
        liveSessionLink.href = '#';
        liveSessionLink.classList.add('live-session-start');
        liveSessionLink.style.opacity = '1';
        liveSessionLink.style.pointerEvents = 'auto';
        liveSessionLink.title = 'Start a new live session';
      }

      liveSessionLink.onclick = function(e) {
        const currentActiveSession = PokerTracker.DataStore.getActiveSession();
        if (!currentActiveSession) {
          e.preventDefault();
          startNewLiveSession();
        }
      };
    } else {
      // DataStore not available, disable link
      liveSessionLink.textContent = 'Live Session';
      liveSessionLink.href = '#';
      liveSessionLink.style.opacity = '0.5';
      liveSessionLink.style.pointerEvents = 'none';
      liveSessionLink.title = 'Live sessions unavailable';
    }

    if (typeof window.checkActiveSession === 'function') {
      window.checkActiveSession();
    }
  }

  function startNewLiveSession() {
    // Check if modal component is available
    if (typeof PokerTracker !== 'undefined' && PokerTracker.Modal) {
      // Use the shared modal with Live Session pre-toggled
      PokerTracker.Modal.showNewSessionModal(true);
    } else {
      // Fallback to prompt method if modal not available
      const sessionName = prompt('Enter a name for this live session:');
      if (!sessionName) return;

      try {
        const newSession = PokerTracker.DataStore.createLiveSession();
        PokerTracker.DataStore.updateSession(newSession.id, { name: sessionName });
        setupLiveSessionNavLink();
        window.location.href = `{{ site.baseurl }}{% link projects/poker_tracker/session.html %}?session_id=${newSession.id}`;
      } catch (error) {
        console.error('Error creating live session:', error);
        console.error('Failed to create live session. Please try again.');
      }
    }
  }

  // Global function to update live session link (can be called from other pages)
  window.updateLiveSessionNavLink = setupLiveSessionNavLink;
</script>
