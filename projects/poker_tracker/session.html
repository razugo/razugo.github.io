---
title: PokerTracker - Session
nav_id: session
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>{{ page.title | default: "PokerTracker" }}</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  {% include_relative components/nav-bar.html %}

  <main>
    <!-- Live Stats Bar (always visible) -->
<div class="live-stats-bar" id="liveStatsBar">
  <div class="live-stats-content">
    <div class="stat-group">
      <span class="stat-label">VPIP</span>
      <span class="stat-value" id="vpipStat">0% (0/0)</span>
    </div>
    <div class="stat-group">
      <span class="stat-label">P&L</span>
      <span class="stat-value" id="profitStat">$0</span>
    </div>
    <div class="stat-group">
      <span class="stat-label">Hands</span>
      <span class="stat-value" id="handsStat">0</span>
    </div>
  </div>
  <button class="live-stats-toggle" onclick="toggleSessionOverlay()">⚙</button>
</div>

<!-- Collapsible Overlay -->
<div class="session-overlay" id="sessionOverlay">
  <div class="session-controls">
    <div>
      <h3 id="sessionTitle">Session Details</h3>
    </div>
    <div>
      <button class="btn btn-outline btn-sm" onclick="endSession()">End Session</button>
    </div>
  </div>

  <!-- Session Data Inputs -->
  <div class="session-inputs" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
    <div>
      <label class="filter-label">Buy In ($)</label>
      <input type="number" id="buyInInput" placeholder="0.00" step="0.01" min="0"
             style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);">
    </div>
    <div>
      <label class="filter-label">Cash Out ($)</label>
      <input type="number" id="cashOutInput" placeholder="0.00" step="0.01" min="0"
             style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);">
    </div>
    <div>
      <label class="filter-label">Game</label>
      <select id="gameSelect" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);">
        <option value="">Select Game</option>
      </select>
    </div>
    <div>
      <label class="filter-label">Status</label>
      <select id="statusSelect" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);">
        <option value="active">Active</option>
        <option value="completed">Completed</option>
      </select>
    </div>
    <div>
      <label class="filter-label">Start Time</label>
      <input type="datetime-local" id="startTimeInput"
             style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);">
    </div>
    <div>
      <label class="filter-label">End Time</label>
      <input type="datetime-local" id="endTimeInput"
             style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);">
    </div>
  </div>

  <!-- Session Notes -->
  <div style="margin-top: 1rem;">
    <label class="filter-label">Session Notes</label>
    <textarea id="sessionNotes" placeholder="Session notes..." style="width: 100%; min-height: 60px; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius); resize: vertical;"></textarea>
  </div>
</div>

<!-- Grid View -->
<div class="container" id="gridView" style="padding-top: 5rem;">
  <!-- View Tabs -->
  <div class="view-tabs" id="viewTabs">
    <button id="gridTab" class="view-tab active">Grid</button>
    <button id="listTab" class="view-tab">List</button>
  </div>

  <div class="poker-grid" id="pokerGrid">
    <!-- Populated by JavaScript -->
  </div>

  <!-- Grid Controls -->
  <div class="filters" style="margin-top: 1.5rem; display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center;">
    <button class="btn btn-outline btn-sm" id="toggleCounts">Show Counts</button>
    <button class="btn btn-outline btn-sm" id="togglePlayed">Show Played</button>
    <button class="btn btn-outline btn-sm" onclick="undoLastHand()">Undo Last</button>
  </div>

  <div style="text-align: center; margin-top: 2rem; color: var(--text-secondary);">
    <p>Quick tap: dealt (folded) | Long press: dealt & played</p>
    <div style="margin-top: 1rem; display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;">
      <span style="display: flex; align-items: center; gap: 0.5rem;">
        <div style="width: 12px; height: 12px; background: rgba(16, 185, 129, 0.2); border: 1px solid #10b981; border-radius: 2px;"></div>
        Played hands
      </span>
      <span style="display: flex; align-items: center; gap: 0.5rem;">
        <div style="width: 12px; height: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 2px;"></div>
        Folded hands
      </span>
    </div>
  </div>
</div>

<!-- List View -->
<div class="container" id="listView" style="padding-top: 5rem; display: none;">
  <!-- View Tabs (duplicate for list view) -->
  <div class="view-tabs">
    <button id="gridTab2" class="view-tab" onclick="switchView('grid')">Grid</button>
    <button id="listTab2" class="view-tab active" onclick="switchView('list')">List</button>
  </div>

  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Hand History</h2>
      <span id="handCount">0 hands</span>
    </div>
    <div class="card-content">
      <div id="handsList" class="hands-list">
        <!-- Populated by JavaScript -->
      </div>
    </div>
  </div>

  <!-- List Controls -->
  <div class="filters" style="margin-top: 1.5rem; display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center;">
    <button class="btn btn-outline btn-sm" id="toggleCounts2">Show Counts</button>
    <button class="btn btn-outline btn-sm" id="togglePlayed2">Show Played</button>
    <button class="btn btn-outline btn-sm" onclick="undoLastHand()">Undo Last</button>
  </div>
</div>

<script>
  let currentSessionId = null;
  let currentView = 'grid';
  let sessionState = {
    showCounts: false,
    showStrength: false,
    showPlayedOnly: false,
    longPressTimer: null,
    isLongPress: false
  };

  // Get session ID from URL parameters
  function getSessionIdFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('session_id');
  }

  function toggleSessionOverlay() {
    document.getElementById('sessionOverlay').classList.toggle('expanded');
  }

  function updateSessionStats() {
    if (!currentSessionId) return;

    const sessionData = PokerTracker.DataStore.getSessionData(currentSessionId);
    const session = PokerTracker.DataStore.getSession(currentSessionId);

    if (!session) return;

    const game = PokerTracker.DataStore.getGame(session.gameId);
    const vpipPercent = sessionData.vpip.toFixed(1);
    const profit = session.cashOut - session.buyIn;
    const duration = Math.floor(Date.now() / 60000) - Math.floor(new Date(session.date).getTime() / 60000);
    const hours = Math.floor(duration / 60);
    const minutes = duration % 60;

    // Update live stats bar
    document.getElementById('vpipStat').textContent = `${vpipPercent}% (${sessionData.totalPlayed}/${sessionData.total})`;

    const profitElement = document.getElementById('profitStat');
    profitElement.textContent = `${profit >= 0 ? '+' : ''}$${profit}`;
    profitElement.className = 'stat-value ' + (profit >= 0 ? 'positive' : 'negative');

    document.getElementById('handsStat').textContent = sessionData.total;

    // Update session overlay
    document.getElementById('sessionTitle').textContent = `Session: ${game ? game.name : 'Unknown Game'}`;

    // Update session inputs
    document.getElementById('buyInInput').value = session.buyIn || '';
    document.getElementById('cashOutInput').value = session.cashOut || '';
    document.getElementById('gameSelect').value = session.gameId || '';
    document.getElementById('statusSelect').value = session.status || 'active';
    document.getElementById('sessionNotes').value = sessionData.notes || '';

    // Update date inputs if available
    if (session.startTime) {
      document.getElementById('startTimeInput').value = new Date(session.startTime).toISOString().slice(0, 16);
    }
    if (session.endTime) {
      document.getElementById('endTimeInput').value = new Date(session.endTime).toISOString().slice(0, 16);
    }

    // Update hand count
    document.getElementById('handCount').textContent = `${sessionData.total} hands`;
  }

  function renderGrid() {
    if (!currentSessionId) return;

    const grid = document.getElementById('pokerGrid');
    if (!grid) return;

    const sessionData = PokerTracker.DataStore.getSessionData(currentSessionId);
    const cells = grid.querySelectorAll('.cell');

    cells.forEach(cell => {
      const handCode = cell.dataset.hand;
      const count = sessionData.counts[handCode] || 0;
      const playedCount = sessionData.playedCounts[handCode] || 0;

      // Reset classes
      cell.className = cell.dataset.baseClass;

      // Apply visual state
      if (count > 0) {
        if (playedCount > 0) {
          cell.classList.add('played');
        } else {
          cell.classList.add('folded');
        }
      }

      // Update content based on display mode
      if (sessionState.showCounts && count > 0) {
        cell.innerHTML = `<span class="hand-code">${handCode}</span><span class="hand-count">${playedCount}/${count}</span>`;
        cell.classList.add('count-display');
      } else {
        cell.textContent = handCode;
      }

      // Hide if showing played only and not played
      if (sessionState.showPlayedOnly && playedCount === 0) {
        cell.style.opacity = '0.3';
      } else {
        cell.style.opacity = '1';
      }
    });
  }

  function renderHandsList() {
    if (!currentSessionId) return;

    const sessionData = PokerTracker.DataStore.getSessionData(currentSessionId);
    const handsList = document.getElementById('handsList');

    if (!handsList) return;

    handsList.innerHTML = sessionData.handHistory
      .slice()
      .reverse()
      .map(hand => `
        <div class="list-item" data-hand-id="${hand.id}">
          <div class="list-item-hand">${hand.key}</div>
          <div class="list-item-position">#${hand.position}</div>
          <div class="list-item-actions">
            <button class="action-button notes-button" onclick="toggleNotes('${hand.id}')">Notes</button>
            <button class="toggle-switch ${hand.played ? 'played' : ''}" onclick="toggleHandStatus('${hand.id}')"></button>
            <button class="delete-button" onclick="deleteHand('${hand.id}')">🗑️</button>
          </div>
          <div class="list-item-notes-container ${hand.notes ? 'active' : ''}">
            <textarea class="list-item-notes" placeholder="Add notes..." onchange="updateHandNotes('${hand.id}', this.value)">${hand.notes || ''}</textarea>
          </div>
        </div>
      `).join('');
  }

  function handleCellInteraction(cell, handCode) {
    // Quick tap - dealt (folded)
    function quickTap() {
      if (sessionState.isLongPress) return;

      PokerTracker.DataStore.addHand(currentSessionId, handCode, false);
      updateSessionStats();
      renderGrid();
      if (currentView === 'list') {
        renderHandsList();
      }

      // Haptic feedback if available
      if (navigator.vibrate) {
        navigator.vibrate(50);
      }
    }

    // Long press - dealt & played
    function longPress() {
      sessionState.isLongPress = true;
      cell.classList.remove('long-pressing');

      PokerTracker.DataStore.addHand(currentSessionId, handCode, true);
      updateSessionStats();
      renderGrid();
      if (currentView === 'list') {
        renderHandsList();
      }

      // Stronger haptic feedback
      if (navigator.vibrate) {
        navigator.vibrate([100, 50, 100]);
      }
    }

    // Mouse/touch events
    cell.addEventListener('mousedown', (e) => {
      e.preventDefault();
      sessionState.isLongPress = false;
      cell.classList.add('long-pressing');

      sessionState.longPressTimer = setTimeout(() => {
        longPress();
      }, 300);
    });

    cell.addEventListener('mouseup', (e) => {
      e.preventDefault();
      clearTimeout(sessionState.longPressTimer);
      cell.classList.remove('long-pressing');

      if (!sessionState.isLongPress) {
        setTimeout(quickTap, 50);
      }
    });

    cell.addEventListener('mouseleave', (e) => {
      clearTimeout(sessionState.longPressTimer);
      cell.classList.remove('long-pressing');
    });

    // Touch events for mobile
    cell.addEventListener('touchstart', (e) => {
      e.preventDefault();
      sessionState.isLongPress = false;
      cell.classList.add('long-pressing');

      sessionState.longPressTimer = setTimeout(() => {
        longPress();
      }, 300);
    });

    cell.addEventListener('touchend', (e) => {
      e.preventDefault();
      clearTimeout(sessionState.longPressTimer);
      cell.classList.remove('long-pressing');

      if (!sessionState.isLongPress) {
        setTimeout(quickTap, 50);
      }
    });

    cell.addEventListener('touchcancel', (e) => {
      clearTimeout(sessionState.longPressTimer);
      cell.classList.remove('long-pressing');
    });
  }

  function generatePokerGrid() {
    const grid = document.getElementById('pokerGrid');
    if (!grid) return;

    const ranks = ['A','K','Q','J','T','9','8','7','6','5','4','3','2'];

    grid.innerHTML = '';
    for (let i = 0; i < 13; i++) {
      for (let j = 0; j < 13; j++) {
        const cell = document.createElement('div');
        const baseClass = 'cell' + (i === j ? ' pair' : '');
        cell.className = baseClass;
        cell.dataset.baseClass = baseClass;

        let handCode;
        if (i === j) {
          handCode = ranks[i] + ranks[i];
        } else if (i < j) {
          handCode = ranks[i] + ranks[j] + 's';
        } else {
          handCode = ranks[j] + ranks[i] + 'o';
        }

        cell.textContent = handCode;
        cell.dataset.hand = handCode;

        handleCellInteraction(cell, handCode);
        grid.appendChild(cell);
      }
    }

    renderGrid();
  }

  function toggleHandStatus(handId) {
    const sessionData = PokerTracker.DataStore.getSessionData(currentSessionId);
    const hand = sessionData.handHistory.find(h => h.id === handId);

    if (hand) {
      PokerTracker.DataStore.updateHandStatus(currentSessionId, handId, !hand.played);
      updateSessionStats();
      renderGrid();
      renderHandsList();
    }
  }

  function deleteHand(handId) {
    if (confirm('Delete this hand?')) {
      PokerTracker.DataStore.deleteHand(currentSessionId, handId);
      updateSessionStats();
      renderGrid();
      renderHandsList();
    }
  }

  function updateHandNotes(handId, notes) {
    PokerTracker.DataStore.updateHandNotes(currentSessionId, handId, notes);
  }

  function toggleNotes(handId) {
    const handItem = document.querySelector(`[data-hand-id="${handId}"]`);
    const notesContainer = handItem.querySelector('.list-item-notes-container');
    const notesButton = handItem.querySelector('.notes-button');

    notesContainer.classList.toggle('active');
    notesButton.classList.toggle('toggle-active');
  }

  function undoLastHand() {
    PokerTracker.DataStore.undoLastHand(currentSessionId);
    updateSessionStats();
    renderGrid();
    if (currentView === 'list') {
      renderHandsList();
    }
  }

  function switchView(view) {
    currentView = view;

    const gridView = document.getElementById('gridView');
    const listView = document.getElementById('listView');

    if (view === 'grid') {
      // Fade out list view
      listView.classList.add('fade-out');

      setTimeout(() => {
        listView.style.display = 'none';
        listView.classList.remove('fade-out');

        gridView.style.display = 'block';
        gridView.classList.add('fade-in');

        setTimeout(() => gridView.classList.remove('fade-in'), 300);
      }, 150);

      // Update both sets of tabs
      document.getElementById('gridTab').classList.add('active');
      document.getElementById('listTab').classList.remove('active');
      document.getElementById('gridTab2').classList.add('active');
      document.getElementById('listTab2').classList.remove('active');
    } else {
      // Fade out grid view
      gridView.classList.add('fade-out');

      setTimeout(() => {
        gridView.style.display = 'none';
        gridView.classList.remove('fade-out');

        listView.style.display = 'block';
        listView.classList.add('fade-in');
        renderHandsList();

        setTimeout(() => listView.classList.remove('fade-in'), 300);
      }, 150);

      // Update both sets of tabs
      document.getElementById('gridTab').classList.remove('active');
      document.getElementById('listTab').classList.add('active');
      document.getElementById('gridTab2').classList.remove('active');
      document.getElementById('listTab2').classList.add('active');
    }
  }

  function endSession() {
    if (confirm('End this session?')) {
      // Logic to end session would go here
      window.location.href = '/projects/poker_tracker/sessions';
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    currentSessionId = getSessionIdFromURL();

    if (!currentSessionId) {
      alert('No session ID provided');
      window.location.href = '/projects/poker_tracker/sessions';
      return;
    }

    const session = PokerTracker.DataStore.getSession(currentSessionId);
    if (!session) {
      alert('Session not found');
      window.location.href = '/projects/poker_tracker/sessions';
      return;
    }

    // Get session data
    const sessionData = PokerTracker.DataStore.getSessionData(currentSessionId);

    // Populate games dropdown
    const gameSelect = document.getElementById('gameSelect');
    const games = PokerTracker.DataStore.getAllGames();
    games.forEach(game => {
      const option = document.createElement('option');
      option.value = game.id;
      option.textContent = `${game.name} (${game.stakes.smallBlind}/${game.stakes.bigBlind})`;
      gameSelect.appendChild(option);
    });

    generatePokerGrid();
    updateSessionStats();

    // Setup session input handlers
    document.getElementById('buyInInput').addEventListener('change', function() {
      PokerTracker.DataStore.updateSession(currentSessionId, { buyIn: parseFloat(this.value) || 0 });
      updateSessionStats();
    });

    document.getElementById('cashOutInput').addEventListener('change', function() {
      PokerTracker.DataStore.updateSession(currentSessionId, { cashOut: parseFloat(this.value) || 0 });
      updateSessionStats();
    });

    document.getElementById('gameSelect').addEventListener('change', function() {
      PokerTracker.DataStore.updateSession(currentSessionId, { gameId: this.value });
      updateSessionStats();
    });

    document.getElementById('statusSelect').addEventListener('change', function() {
      PokerTracker.DataStore.updateSession(currentSessionId, { status: this.value });
      updateSessionStats();
    });

    document.getElementById('startTimeInput').addEventListener('change', function() {
      PokerTracker.DataStore.updateSession(currentSessionId, { startTime: new Date(this.value).toISOString() });
    });

    document.getElementById('endTimeInput').addEventListener('change', function() {
      PokerTracker.DataStore.updateSession(currentSessionId, { endTime: new Date(this.value).toISOString() });
    });

    // Setup control buttons (below grid/list)
    document.getElementById('toggleCounts').addEventListener('click', function() {
      sessionState.showCounts = !sessionState.showCounts;
      this.textContent = sessionState.showCounts ? 'Hide Counts' : 'Show Counts';
      document.getElementById('toggleCounts2').textContent = this.textContent;
      renderGrid();
    });

    document.getElementById('toggleCounts2').addEventListener('click', function() {
      sessionState.showCounts = !sessionState.showCounts;
      this.textContent = sessionState.showCounts ? 'Hide Counts' : 'Show Counts';
      document.getElementById('toggleCounts').textContent = this.textContent;
      renderGrid();
    });

    document.getElementById('togglePlayed').addEventListener('click', function() {
      sessionState.showPlayedOnly = !sessionState.showPlayedOnly;
      this.textContent = sessionState.showPlayedOnly ? 'Show All' : 'Show Played';
      document.getElementById('togglePlayed2').textContent = this.textContent;
      renderGrid();
    });

    document.getElementById('togglePlayed2').addEventListener('click', function() {
      sessionState.showPlayedOnly = !sessionState.showPlayedOnly;
      this.textContent = sessionState.showPlayedOnly ? 'Show All' : 'Show Played';
      document.getElementById('togglePlayed').textContent = this.textContent;
      renderGrid();
    });

    // View tab handlers
    document.getElementById('gridTab').addEventListener('click', () => switchView('grid'));
    document.getElementById('listTab').addEventListener('click', () => switchView('list'));

    // Session notes handler
    document.getElementById('sessionNotes').addEventListener('change', function() {
      PokerTracker.DataStore.updateSessionNotes(currentSessionId, this.value);
    });
  });
</script>

<!-- Shared JavaScript -->
<script src="assets/js/data-store.js"></script>
<script src="assets/js/app.js"></script>

<script>
  function quickAction() {
    if (currentSessionId) {
      const sessionData = PokerTracker.DataStore.getSessionData(currentSessionId);
      if (sessionData.total > 0) {
        document.getElementById('viewTabs').style.display = 'flex';
        switchView(currentView === 'grid' ? 'list' : 'grid');
      }
    }
  }
</script>


  </main>
</body>
</html>